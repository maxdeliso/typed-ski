<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hephaestus - SKI Arena Evaluator</title>
    <link rel="stylesheet" href="/server/workbench.css">
  </head>
  <body>
    <button class="floating-gear" id="gearButton" title="Scroll to controls">
      ‚öôÔ∏è
    </button>
    <div class="container" id="controlsContainer">
      <h1>‚öíÔ∏è Hephaestus - SKI Arena Evaluator</h1>

      <div class="controls">
        <div class="control-row">
          <label>
            SKI Expression:
            <input
              type="text"
              id="exprInput"
              value="SKKI"
              placeholder="e.g., SKKI, III, KIS"
              style="width: 300px"
            >
          </label>
          <label>
            Random Size:
            <input
              type="number"
              id="randomSizeInput"
              value="10"
              min="1"
              max="100"
            >
          </label>
          <button id="generateRandomBtn" class="btn-info">
            üé≤ Generate Random
          </button>
        </div>
        <div class="control-row">
          <button id="runBtn" class="btn-primary">‚ñ∂ Run</button>
          <button id="resetBtn" class="btn-secondary">Reset</button>
          <button id="hammerTimeBtn" class="btn-danger">üî® Hammer Time</button>
        </div>
        <div class="control-row">
          <label>
            Worker Count:
            <input
              type="number"
              id="workerCountInput"
              value="4"
              min="1"
              max="16"
            >
          </label>
          <label>
            Max Steps:
            <input
              type="number"
              id="maxStepsInput"
              value="1000"
              min="1"
              max="1000000"
            >
          </label>
          <div class="toggle-container">
            <span style="font-weight: 600; color: #555">Continuous Mode:</span>
            <div class="toggle-switch" id="continuousToggle"></div>
          </div>
          <label id="batchSizeLabel" style="align-items: center">
            Parallelism (max in-flight):
            <input
              type="number"
              id="batchSizeInput"
              value="8"
              min="1"
              max="256"
              style="width: 90px; margin-left: 5px; padding: 10px 15px"
            >
          </label>
        </div>
      </div>

      <div class="status-bar">
        <div class="status-item">
          <span class="status-label">WASM Status:</span>
          <span class="status-value" id="wasmStatus">Loading...</span>
        </div>
        <div class="status-item">
          <span class="status-label">Total Pending:</span>
          <span class="status-value" id="totalPending">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">Completed:</span>
          <span class="status-value" id="totalCompleted">0</span>
        </div>
        <div class="status-item">
          <span class="status-label">Errors:</span>
          <span class="status-value" id="totalErrors">0</span>
        </div>
      </div>

      <div class="log-panel">
        <div class="log-header">
          <div class="log-title">Log</div>
        </div>
        <div class="log-output" id="logOutput"></div>
      </div>

      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="avgTime">0</div>
          <div class="stat-label">Avg Time (ms)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="totalTime">0</div>
          <div class="stat-label">Cumulative Latency (ms)</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="throughput">0</div>
          <div class="stat-label">Throughput (expr/s)</div>
        </div>
      </div>
    </div>

    <div class="loading-overlay hidden" id="loadingOverlay">
      <div style="text-align: center">
        <div class="spinner"></div>
        <div class="loading-text">Processing...</div>
      </div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@maxdeliso/typed-ski": "/lib/index.ts"
        }
      }
    </script>
    <script type="module" src="/server/workbench.js"></script>
  </body>
</html>
