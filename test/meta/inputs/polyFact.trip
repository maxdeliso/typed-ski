module PolyFact

type Nat = #X -> (X -> X) -> X -> X

poly zero = #X => \s: X -> X => \z : X => z

poly succ =
  \n : Nat =>
    #a => \s : a -> a => \z : a =>
      s (n [a] s z)

poly pair = #A => #B => \a : A => \b : B => #Y => \k : A -> B -> Y => k a b

poly fst = #A => #B => \p : #Y -> (A->B->Y)->Y =>
  p [A] (\x:A => \y:B => x)

poly snd = #A => #B => \p : #Y -> (A->B->Y)->Y =>
  p [B] (\x:A => \y:B => y)

poly mul =
  \m : Nat => \n : Nat =>
    #a => \s : a -> a => \z : a =>
      m [a] (n [a] s) z

poly one = succ zero

poly fact = \n : Nat =>
  fst Nat Nat
    (n [#Y -> (Nat -> Nat -> Y) -> Y]
      (\p : #Y -> (Nat -> Nat -> Y) -> Y =>
        pair Nat Nat
          (mul (fst Nat Nat p) (snd Nat Nat p))
          (succ (snd Nat Nat p))
      )
      (pair Nat Nat one one)
    )

poly main = fact (succ (succ (succ (succ zero))))
